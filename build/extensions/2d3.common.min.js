"use strict";var _interopRequire=function(a){return a&&a.__esModule?a["default"]:a},_slicedToArray=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){for(var c,d=[],e=a[Symbol.iterator]();!(c=e.next()).done&&(d.push(c.value),!b||d.length!==b););return d}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(exports,"__esModule",{value:!0});var d3=_interopRequire(require("../../node_modules/d3/d3")),requestAnimationFunction=require("../external/requestAnimationFunction.amd").requestAnimationFunction,mixin=require("../external/mixin.amd").mixin,$force=Symbol(),$svg=Symbol(),$circle_data=Symbol(),$path_data=Symbol(),$graph=Symbol(),$resize=Symbol(),$options=Symbol(),D3SVG=exports.D3SVG=function(){function a(b,c,d){var e=this;if(_classCallCheck(this,a),!b)throw Error("No svg element specified");if(!c)throw Error("No graph specified");this[$options]=d=mixin({circle:{radius:6},arrow:{width:6,ratio:2},force:{charge:-200,linkDistance:36,linkStrength:2.5,gravity:.15},size:{ratio:1,resizing:!0},drawing:!0},d,!1);var f=d3.layout.force();f.charge(d.force.charge),f.linkDistance(d.force.linkDistance),f.linkStrength(d.force.linkStrength),f.gravity(d.force.gravity),this[$resize]=requestAnimationFunction(function(){var a=getComputedStyle(b),c=a.width,g=a.height;e[$options].size.resizing&&(b.viewBox.baseVal.width=parseFloat(c)/d.size.ratio,b.viewBox.baseVal.height=parseFloat(g)/d.size.ratio),f.size([b.viewBox.baseVal.width,b.viewBox.baseVal.height]),f.alpha(.1)}),this[$graph]=c,this[$force]=f,this[$svg]=d3.select(b),this[$force].on("tick",function(){e.drawing&&(e[$circle_data].attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),e[$path_data].attr("d",function(a){var b=a.source,c=a.target,e=b.x-c.x,f=b.y-c.y,g=Math.hypot(e,f),h=e/g*d.arrow.width,i=f/g*d.arrow.width;isNaN(h)&&(h=0),isNaN(i)&&(i=0);var j=b.x-h*d.arrow.ratio,k=b.y-i*d.arrow.ratio;return"M"+c.x+","+c.y+"L "+j+","+k+"L "+(b.x+i)+","+(b.y-h)+"L "+(b.x-i)+","+(b.y+h)+"L "+j+","+k}))}),this.resize(),this.update()}return _createClass(a,{update:{value:function(){var a=this,b=new Map(function(){var b=[],c=!0,d=!1,e=void 0;try{for(var f,g=a[$graph].nodes[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=_slicedToArray(f.value,1),i=h[0];b.push([i,{value:i}])}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return b}()),c=function(){var a=[],c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=_slicedToArray(f.value,2),i=h[1];a.push(i)}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return a}(),d=function(){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[$graph].edges[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=i.source,k=i.target;c.push({source:b.get(j),target:b.get(k)})}}catch(l){e=!0,f=l}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}();this[$force].nodes(c).links(d).start(),this[$path_data]=this[$svg].selectAll("path.edge").data(d),this[$circle_data]=this[$svg].selectAll("circle.node").data(c),this[$path_data].enter().append("path").attr("class","edge"),this[$circle_data].enter().append("circle").attr("r",this[$options].circle.radius).attr("class","node").call(this[$force].drag),this[$path_data].exit().remove(),this[$circle_data].exit().remove(),this[$svg].selectAll("circle.node,path.edge").sort(function(a){return("index"in a)-.5})}},resize:{value:function(){this[$resize]()}},graph:{get:function(){return this[$graph]}},force:{get:function(){return this[$force]}},drawing:{get:function(){return this[$options].drawing},set:function(a){this[$options].drawing=!!a}},ratio:{get:function(){return this[$options].size.ratio},set:function(){var a=void 0===arguments[0]?1:arguments[0];a=parseFloat(a),a>0&&1/0>a&&(this[$options].size.ratio=a)}},resizing:{get:function(){return this[$options].size.resizing},set:function(a){this[$options].size.resizing=!!a}}}),a}();