define(["exports","module","../../graph","../../../node_modules/d3/d3","../../external/mixin","../../external/layer","../../external/requestAnimationFunction"],function(a,b,c,d,e,f,g){"use strict";function h(a){a[v]={},a[w]=o.select(a.svg);var b=o.layout.force();a[s]=b,b.on("tick",i.bind(a)),b.size([x,x]),a.resize(),addEventListener("polymer-ready",a.resize);var c=q(a.options.size,{ratio:{translate:function(b){console.log("ratio",b),a.resize()},duration:280},offset:{x:{translate:function(b){console.log("x",b),a.resize()}},y:{translate:function(b){console.log("y",b),a.resize()}}}});a.svg.addEventListener("wheel",function(b){{var d=(b.layerX,b.layerY,b.wheelDelta),e=getComputedStyle(a.svg);e.width,e.height}c.ratio=Math.max(0,c.ratio+d/20)}),PolymerGestures.addEventListener(a.svg,"tap",function(b){console.log("tap"),b.bubbles=!1,b.srcElement===a.svg&&(a[w].selectAll("circle.node").each(function(){this.classList.remove("selected")}),a.dispatchEvent(new CustomEvent("deselect")))}),a.svg.addEventListener("click",function(a){var b=a.layerX,c=a.layerY;return console.log(b,c)}),!function(){var b=void 0,d=void 0;PolymerGestures.addEventListener(a.svg,"pinch",function(a){var e=a.scale,f=a.preventTap;f(),void 0!==d&&(c.ratio=Math.max(0,c.ratio+2*(e-d)),clearTimeout(b),b=setTimeout(function(){d=void 0},1e3)),d=e})}(),PolymerGestures.addEventListener(a.svg,"track",function(b){if(console.log("track"),b.bubbles=!1,b.srcElement===a.svg){var c=a.options.size.ratio;a.options.size.offset.x+=b.ddx/c,a.options.size.offset.y+=b.ddy/c}}),!function(){var b=void 0;PolymerGestures.addEventListener(a.svg,"hold",function(c){console.log("hold"),c.bubbles=!1,c.preventTap(),c.srcElement===a.svg&&(b=!1)}),PolymerGestures.addEventListener(a.svg,"holdpulse",function(c){var d=(c.x,c.y,c.srcElement),e=c.holdTime;if(console.log("holdpulse"),event.bubbles=!1,d===a.svg&&e>800&&!b){var f=function(){return a.graph.nodes.size};b=!0,console.log("add node"),a.graph.addNode(f()),a.updateGraph()}})}()}function i(){var a=this.svg.viewBox.baseVal,b=a.x,c=a.y,d=a.width,e=a.height,f=this.options.size.offset,g=this.options.size.ratio;b=b*g+f.x,c=c*g+f.y,d*=g/x,e*=g/x;var h=this.options.arrow,i=this[v],j=i.circles,k=i.paths;j&&j.attr("transform",function(a){return"translate("+(a.x*d+b)+","+(a.y*e+c)+")"}),k&&k.attr("d",function(a){var f=a.source,g=a.target,i=f.x*d+b,j=f.y*e+c,k=g.x*d+b,l=g.y*e+c,m=i-k,n=j-l,o=Math.hypot(m,n),p=m/o*h.width,q=n/o*h.width;isNaN(p)&&(p=0),isNaN(q)&&(q=0);var r=i-p*h.ratio,s=j-q*h.ratio;return"M"+k+","+l+"L "+r+","+s+"L "+(i+q)+","+(j-p)+"L "+(i-q)+","+(j+p)+"L "+r+","+s})}function j(a){var b={circle:{radius:6},arrow:{width:5.5,ratio:2},force:{charge:-200,linkDistance:30,linkStrength:1,gravity:.15,enabled:!0,start:function(){if(console.log("start",a.options.force.enabled),a.options.force.enabled){var b=a.force;b.start(),b.alpha(.1)}}},size:{ratio:2,offset:{x:0,y:0}}};a[t]=b,a[u]=q(b,{circle:{radius:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a.force.stop(),a.options.force.start())})}},arrow:{width:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a.force.stop(),a.options.force.start())})},ratio:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.abs(parseFloat(b)),1/0>b&&(c(b),a.force.stop(),a.options.force.start())})}},force:{charge:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a.force.charge(b).stop(),a.options.force.start())})},linkDistance:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){if(b=Math.max(0,parseFloat(b)),1/0>b){var d=getComputedStyle(a.svg),e=d.width,f=d.height;c(b),a.force.linkDistance(2e3*b/Math.hypot(parseFloat(e),parseFloat(f))).stop(),a.options.force.start()}})},linkStrength:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.max(0,parseFloat(b)),1/0>b&&(c(b),a.force.linkStrength(b).stop(),a.options.force.start())})},gravity:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.max(0,parseFloat(b)),1/0>b&&(c(b),a.force.gravity(b).stop(),a.options.force.start())})},enabled:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){c(!!b),b?a.force.start():a.force.stop()})}},size:{ratio:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.max(y,parseFloat(b)),1/0>b&&(c(b),a.resize())})},offset:{x:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a.resize())})},y:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a.resize())})}}}})}function k(a,b){console.log("entering circles",b),b.each(function(b){var c=this;PolymerGestures.addEventListener(this,"tap",function(d){d.preventTap(),d.bubbles=!1;var e=c;a[w].selectAll("circle.node").each(function(){this!==e&&this.classList.remove("selected")}),e.classList.add("selected"),a.dispatchEvent(new CustomEvent("select",{detail:{circle:e,datum:b}}))}),PolymerGestures.addEventListener(this,"trackstart",function(b){b.preventTap(),b.bubbles=!1,a.force.stop()}),PolymerGestures.addEventListener(this,"track",function(c){c.bubbles=!1;var d=a.toNodeCoordinates(c.ddx,c.ddy),e=d.x,f=d.y;b.x+=e,b.y+=f,i.call(a)}),PolymerGestures.addEventListener(this,"trackend",function(b){b.bubbles=!1,a.options.force.start()})})}var l=function(a){return a&&a.__esModule?a["default"]:a},m=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){for(var c,d=[],e=a[Symbol.iterator]();!(c=e.next()).done&&(d.push(c.value),!b||d.length!==b););return d}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=c.Graph,o=l(d),p=l(e),q=l(f),r=l(g),s=Symbol(),t=Symbol(),u=Symbol(),v=Symbol(),w=Symbol(),x=1e3,y=.35;b.exports=Object.defineProperties({is:"graphjs-tezcatlipoca",ready:function(){h(this),this.options=this[t]},created:function(){var a=this;j(a),a.resize=r(function(){var b=a.svg,c=getComputedStyle(b),d=c.width,e=c.height,f=a[t].size.ratio;d=parseFloat(d)/f,e=parseFloat(e)/f,p(b.viewBox.baseVal,{x:-d/2,y:-e/2,width:d,height:e},p.OVERRIDE),a.options.force.linkDistance+=0,a.options.force.start(),i.call(a)})},attached:function(){addEventListener("resize",this.resize)},detached:function(){removeEventListener("resize",this.resize)},observe:{graph:"updateGraph"},updateGraph:function(){var a=this;this.graph?!function(){var b=new Map(function(){var b=[],c=!0,d=!1,e=void 0;try{for(var f,g=a.graph.nodes[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=m(f.value,1),i=h[0];b.push([i,{value:i}])}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return b}()),c=function(){var a=[],c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=m(f.value,2),i=h[1];a.push(i)}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return a}(),d=function(){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a.graph.edges[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=i.source,k=i.target;c.push({source:b.get(j),target:b.get(k)})}}catch(l){e=!0,f=l}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}(),e=a.force;e.nodes(c).links(d);var f=a[w],g=f.selectAll("circle.node").data(c),h=f.selectAll("path.edge").data(d);a[v]={circles:g,paths:h},h.enter().append("path").attr("class","edge");var i=g.enter().append("circle").attr("r",a[t].circle.radius).attr("class","node");k(a,i),h.exit().remove(),g.exit().remove(),f.selectAll("circle.node,path.edge").sort(function(a){return("value"in a)-.5}),e.start();for(var j=0;10>j;++j)e.tick();e.alpha(0),a.options.force.start()}():this.graph=new n},toNodeCoordinates:function(a,b){{var c=getComputedStyle(this.svg),d=c.width,e=c.height,f=this.options.size.ratio;this.svg.viewBox.baseVal}return{x:a/parseFloat(d)/f*x,y:b/parseFloat(e)/f*x}}},{svg:{get:function(){return this.$.svg},configurable:!0,enumerable:!0},force:{get:function(){return this[s]},configurable:!0,enumerable:!0},options:{get:function(){return this[u]},set:function(a){p(this[u],a,p.OVERRIDE)},configurable:!0,enumerable:!0}})});