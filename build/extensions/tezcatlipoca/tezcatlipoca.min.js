define(["exports","module","../../graph","../../../node_modules/d3/d3","../../external/mixin","../../external/layer","../../external/requestAnimationFunction"],function(a,b,c,d,e,f,g){"use strict";function h(a){a[u]={},a[v]=n.select(a.svg);var b=n.layout.force();a[r]=b,b.on("tick",i.bind(a)),b.size([w,w]),a.resize(),addEventListener("polymer-ready",a.resize);var c=p(a.options.size,{ratio:{translate:function(b){console.log("ratio",b),a.resize()},duration:280},offset:{x:{translate:function(b){console.log("x",b),a.resize()}},y:{translate:function(b){console.log("y",b),a.resize()}}}});a.svg.addEventListener("wheel",function(b){{var d=(b.layerX,b.layerY,b.wheelDelta),e=getComputedStyle(a.svg);e.width,e.height}c.ratio=Math.max(0,c.ratio+d/20)}),a.svg.addEventListener("click",function(a){var b=a.layerX,c=a.layerY;return console.log(b,c)}),!function(){var b=void 0,d=void 0;PolymerGestures.addEventListener(a.svg,"pinch",function(a){var e=a.scale,f=a.preventTap;f(),void 0!==d&&(c.ratio=Math.max(0,c.ratio+2*(e-d)),clearTimeout(b),b=setTimeout(function(){d=void 0},1e3)),d=e})}(),PolymerGestures.addEventListener(a.svg,"track",function(b){var c=b.ddx,d=b.ddy,e=b.srcElement,f=b.preventTap;if(console.log("track"),f(),e===a.svg){var g=a.options.size.ratio;a.options.size.offset.x+=c/g,a.options.size.offset.y+=d/g}})}function i(){var a=this.svg.viewBox.baseVal,b=a.x,c=a.y,d=a.width,e=a.height,f=this.options.size.offset,g=this.options.size.ratio;b=b*g+f.x,c=c*g+f.y,d*=g/w,e*=g/w;var h=this.options.arrow,i=this[u],j=i.circles,k=i.paths;j&&j.attr("transform",function(a){return"translate("+(a.x*d+b)+","+(a.y*e+c)+")"}),k&&k.attr("d",function(a){var f=a.source,g=a.target,i=f.x*d+b,j=f.y*e+c,k=g.x*d+b,l=g.y*e+c,m=i-k,n=j-l,o=Math.hypot(m,n),p=m/o*h.width,q=n/o*h.width;isNaN(p)&&(p=0),isNaN(q)&&(q=0);var r=i-p*h.ratio,s=j-q*h.ratio;return"M"+k+","+l+"L "+r+","+s+"L "+(i+q)+","+(j-p)+"L "+(i-q)+","+(j+p)+"L "+r+","+s})}function j(a){var b={circle:{radius:6},arrow:{width:5.5,ratio:2},force:{charge:-200,linkDistance:36,linkStrength:1,gravity:.15},size:{ratio:1,offset:{x:0,y:0}}};a[s]=b,a[t]=p(b,{circle:{radius:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a[r].stop().start())})}},arrow:{width:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a[r].stop().start())})},ratio:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.abs(parseFloat(b)),1/0>b&&(c(b),a[r].stop().start())})}},force:{charge:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a[r].charge(b).stop().start())})},linkDistance:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.max(0,parseFloat(b)),1/0>b&&(c(b),a[r].linkDistance(b).stop().start())})},linkStrength:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.max(0,parseFloat(b)),1/0>b&&(c(b),a[r].linkStrength(b).stop().start())})},gravity:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.max(0,parseFloat(b)),1/0>b&&(c(b),a[r].gravity(b).stop().start())})}},size:{ratio:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=Math.max(x,parseFloat(b)),1/0>b&&(c(b),a.resize())})},offset:{x:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a.resize())})},y:{set:function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(b,c){b=parseFloat(b),1/0>b&&b>-(1/0)&&(c(b),a.resize())})}}}})}var k=function(a){return a&&a.__esModule?a["default"]:a},l=function(a,b){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a)){for(var c,d=[],e=a[Symbol.iterator]();!(c=e.next()).done&&(d.push(c.value),!b||d.length!==b););return d}throw new TypeError("Invalid attempt to destructure non-iterable instance")},m=c.Graph,n=k(d),o=k(e),p=k(f),q=k(g),r=Symbol(),s=Symbol(),t=Symbol(),u=Symbol(),v=Symbol(),w=1e3,x=.35;b.exports=Object.defineProperties({is:"graphjs-tezcatlipoca",ready:function(){h(this),this.options=this[s]},created:function(){var a=this;j(a),a.resize=q(function(){var b=a.svg,c=getComputedStyle(b),d=c.width,e=c.height,f=a[s].size.ratio;d=parseFloat(d)/f,e=parseFloat(e)/f,o(b.viewBox.baseVal,{x:-d/2,y:-e/2,width:d,height:e},o.OVERRIDE);var g=a[r];g.alpha(.1)})},attached:function(){addEventListener("resize",this.resize)},detached:function(){removeEventListener("resize",this.resize)},observe:{graph:"updateGraph"},updateGraph:function(){var a=this;this.graph?!function(){var b=new Map(function(){var b=[],c=!0,d=!1,e=void 0;try{for(var f,g=a.graph.nodes[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=l(f.value,1),i=h[0];b.push([i,{value:i}])}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return b}()),c=function(){var a=[],c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=l(f.value,2),i=h[1];a.push(i)}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return a}(),d=function(){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a.graph.edges[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=i.source,k=i.target;c.push({source:b.get(j),target:b.get(k)})}}catch(l){e=!0,f=l}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}(),e=a[r];e.nodes(c).links(d);var f=a[v],g=f.selectAll("circle.node").data(c),h=f.selectAll("path.edge").data(d);a[u]={circles:g,paths:h},h.enter().append("path").attr("class","edge"),g.enter().append("circle").attr("r",a[s].circle.radius).attr("class","node"),h.exit().remove(),g.exit().remove(),f.selectAll("circle.node,path.edge").sort(function(a){return("value"in a)-.5}),e.start()}():this.graph=new m}},{svg:{get:function(){return this.$.svg},configurable:!0,enumerable:!0},force:{get:function(){return this[r]},configurable:!0,enumerable:!0},options:{get:function(){return this[t]},set:function(a){o(this[t],a,o.OVERRIDE)},configurable:!0,enumerable:!0}})});