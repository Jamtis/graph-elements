define(["exports","../../node_modules/d3/d3","../external/requestAnimationFunction.c"],function(exports,_node_modulesD3D3,_externalRequestAnimationFunctionC){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr)){for(var _step,_arr=[],_iterator=arr[Symbol.iterator]();!(_step=_iterator.next()).done&&(_arr.push(_step.value),!i||_arr.length!==i););return _arr}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(exports,"__esModule",{value:!0});{var d3=_interopRequire(_node_modulesD3D3),requestAnimationFunction=_externalRequestAnimationFunctionC.requestAnimationFunction,$force=Symbol(),$svg=Symbol(),$dom_svg=Symbol(),$circle_data=Symbol(),$path_data=Symbol(),$graph=Symbol(),$resize=Symbol(),$drawing=Symbol(),$options=Symbol();exports.D3SVG=function(){function D3SVG(svg,graph){var _this=this,_ref=void 0===arguments[2]?{}:arguments[2],_ref$circle=_ref.circle;_ref$circle=void 0===_ref$circle?{}:_ref$circle;var _ref$circle$radius=_ref$circle.radius,radius=void 0===_ref$circle$radius?6:_ref$circle$radius,_ref$arrow=_ref.arrow;_ref$arrow=void 0===_ref$arrow?{}:_ref$arrow;var _ref$arrow$width=_ref$arrow.width,width=void 0===_ref$arrow$width?6:_ref$arrow$width,_ref$arrow$ratio=_ref$arrow.ratio,ratio=void 0===_ref$arrow$ratio?2:_ref$arrow$ratio,_ref$force=_ref.force;_ref$force=void 0===_ref$force?{}:_ref$force;var _ref$force$charge=_ref$force.charge,charge=void 0===_ref$force$charge?-200:_ref$force$charge,_ref$force$linkDistance=_ref$force.linkDistance,linkDistance=void 0===_ref$force$linkDistance?36:_ref$force$linkDistance,_ref$force$linkStrength=_ref$force.linkStrength,linkStrength=void 0===_ref$force$linkStrength?2.5:_ref$force$linkStrength,_ref$force$gravity=_ref$force.gravity,gravity=void 0===_ref$force$gravity?.15:_ref$force$gravity;if(_classCallCheck(this,D3SVG),!svg)throw Error("No svg element specified");if(!graph)throw Error("No graph specified");this[$options]={circle:{radius:radius},arrow:{width:width,ratio:ratio},force:{charge:charge,linkDistance:linkDistance,linkStrength:linkStrength,gravity:gravity}};var force=d3.layout.force();force.charge(charge),force.linkDistance(linkDistance),force.linkStrength(linkStrength),force.gravity(gravity),this[$resize]=requestAnimationFunction(function(){var _getComputedStyle=getComputedStyle(svg),width=_getComputedStyle.width,height=_getComputedStyle.height;force.size([parseInt(width),parseInt(height)]),force.alpha(.1)}),this[$drawing]=!0,this[$graph]=graph,this[$dom_svg]=svg,this[$force]=force,this[$svg]=window.svg=d3.select(svg),this[$force].on("tick",function(){_this.drawing&&(_this[$circle_data].attr("transform",function(node){return"translate("+node.x+","+node.y+")"}),_this[$path_data].attr("d",function(_ref2){var source=_ref2.source,target=_ref2.target,dx=source.x-target.x,dy=source.y-target.y,hyp=Math.hypot(dx,dy),wx=dx/hyp*width,wy=dy/hyp*width,px=source.x-wx*ratio,py=source.y-wy*ratio;return"M"+target.x+","+target.y+"L "+px+","+py+"L "+(source.x+wy)+","+(source.y-wx)+"L "+(source.x-wy)+","+(source.y+wx)+"L "+px+","+py}))}),this.resize(),this.update()}return _createClass(D3SVG,{update:{value:function(){var _this=this,node_map=new Map(function(){var _ref=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this[$graph].nodes[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,1),i=_step$value[0];_ref.push([i,{value:i,x:Math.random(),y:Math.random()}])}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return _ref}()),nodes=function(){var _nodes=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=node_map[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),node=_step$value[1];_nodes.push(node)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return _nodes}(),edges=function(){var _edges=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this[$graph].edges[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_step.value,source=_step$value.source,target=_step$value.target;_edges.push({source:node_map.get(source),target:node_map.get(target)})}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return _edges}();this[$force].nodes(nodes).links(edges),this[$path_data]=this[$svg].selectAll("path").data(edges),this[$circle_data]=this[$svg].selectAll("circle").data(nodes),this[$path_data].enter().append("path"),this[$circle_data].enter().append("circle").attr("r",this[$options].circle.radius).call(this[$force].drag),this[$path_data].exit().remove(),this[$circle_data].exit().remove()}},resize:{value:function(){this[$resize]()}},graph:{get:function(){return this[$graph]}},force:{get:function(){return this[$force]}},drawing:{get:function(){return this[$drawing]},set:function(){var drawing=void 0===arguments[0]?!0:arguments[0];return this[$drawing]=!!drawing}}}),D3SVG}()}});