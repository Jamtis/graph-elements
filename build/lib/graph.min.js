"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},_slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,"__esModule",{value:!0});var $directed=Symbol(),Graph=exports.Graph=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];_classCallCheck(this,a),Object.defineProperty(this,"nodes",{value:new Map}),this.directed=!!b}return _createClass(a,[{key:"addNode",value:function(a){if(this.hasNode(a))return!1;var b={};return Object.defineProperties(b,{dependents:{value:new Map},dependencies:{value:new Map}}),this.nodes.set(a,b),!0}},{key:"hasNode",value:function(a){return this.nodes.has(a)}},{key:"removeNode",value:function(a){if(!this.hasNode(a))return!1;var b=this.nodes.get(a);this.nodes["delete"](a);var c=!0,d=!1,e=void 0;try{for(var f,g=b.dependencies[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=_slicedToArray(f.value,2),i=h[1];i["delete"](a)}}catch(j){d=!0,e=j}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}var k=!0,l=!1,m=void 0;try{for(var n,o=b.dependents[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){var p=_slicedToArray(n.value,2),q=p[1];q["delete"](a)}}catch(j){l=!0,m=j}finally{try{!k&&o["return"]&&o["return"]()}finally{if(l)throw m}}return!0}},{key:"addEdge",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?1:arguments[2],d=this.nodes;return d.has(a)&&d.has(b)?(d.get(a).dependents.set(b,c),d.get(b).dependencies.set(a,c),this.directed||(d.get(b).dependents.set(a,c),d.get(a).dependencies.set(b,c)),!0):!1}},{key:"removeEdge",value:function(a,b){var c=this.nodes;return c.has(a)&&c.has(b)?(c.get(a).dependents["delete"](b),c.get(b).dependencies["delete"](a),this.directed||(c.get(b).dependents["delete"](a),c.get(a).dependencies["delete"](b)),!0):!1}},{key:"hasEdge",value:function(a,b){return this.hasNode(a)&&this.hasNode(b)&&this.nodes.get(a).dependents.has(b)}},{key:"clear",value:function(){return this.nodes.clear()}},{key:"hasCycle",value:function(){return!!this.getCycle.apply(this,arguments)}},{key:"getCycle",value:function(){function a(e,f,g){if(!c.has(e)){if(d.has(e))return g;d.add(e);var h=this.nodes,i=!0,j=!1,k=void 0;try{for(var l,m=e.dependents[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=_slicedToArray(l.value,1),o=n[0],p=h.get(o);if(b||p!==f){var q=a.call(this,p,e,g+1);if(q)return q}}}catch(r){j=!0,k=r}finally{try{!i&&m["return"]&&m["return"]()}finally{if(j)throw k}}c.add(e)}}var b=this.directed,c=new Set,d=new Set,e=!0,f=!1,g=void 0;try{for(var h,i=this.nodes[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=_slicedToArray(h.value,2),k=j[1],l=a.call(this,k,void 0,0);if(l)return l}}catch(m){f=!0,g=m}finally{try{!e&&i["return"]&&i["return"]()}finally{if(f)throw g}}return 0}},{key:"getDegree",value:function(a){var b=this.nodes.get(a);return b?{node:a,"in":b.dependencies.size,out:b.dependents.size}:this.nodes.map(function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1];return{node:c,"in":d.dependencies.size,out:d.dependents.size}})}},{key:"directed",get:function(){return this[$directed]},set:function(a){if(this[$directed]=!!a,this.directed){var b=!0,c=!1,d=void 0;try{for(var e,f=this.edges[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;this.addEdge.apply(this,_toConsumableArray(g))}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}}}},{key:"edges",get:function(){return this.nodes.map(function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1];return d.dependents.map(function(a){var b=_slicedToArray(a,2),d=b[0],e=b[1];return{source:c,target:d,weight:e}})})}}]),a}(),AcyclicGraph=exports.AcyclicGraph=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"addEdge",value:function(a,c,d){var e=_get(Object.getPrototypeOf(b.prototype),"addEdge",this).call(this,a,c,d);if(e&&this.hasCycle(!0)){if(this.removeEdge(a,c))return!1;throw Error("Cyclic node could not be removed")}return e}},{key:"getCycle",value:function(){var a=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return a?_get(Object.getPrototypeOf(b.prototype),"getCycle",this).call(this):0}},{key:"hasCycle",value:function(){var a=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return!!_get(Object.getPrototypeOf(b.prototype),"hasCycle",this).call(this,a)}}]),b}(Graph),Tree=exports.Tree=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,Object.getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"addEdge",value:function(a,c,d){return this.nodes.get(c).dependencies.size>0?!1:_get(Object.getPrototypeOf(b.prototype),"addEdge",this).call(this,a,c,d)}}]),b}(AcyclicGraph);